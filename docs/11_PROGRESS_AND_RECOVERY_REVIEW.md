# é€²æ—ç®¡ç†ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒªã‚«ãƒãƒªãƒ¼æ©Ÿèƒ½ãƒ¬ãƒ“ãƒ¥ãƒ¼

## ğŸ“Š ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡
1. ã‚·ãƒ¼ãƒ³åˆ†å‰²ï¼ˆFormat APIï¼‰ã®é€²æ—ç®¡ç†
2. ç”»åƒç”Ÿæˆï¼ˆImage Generation APIï¼‰ã®é€²æ—ç®¡ç†
3. ä¸€æ‹¬å‡¦ç†ä¸­ã®å€‹åˆ¥æ“ä½œã®ç«¶åˆå•é¡Œ
4. å¤±æ•—æ™‚ã®ãƒªã‚«ãƒãƒªãƒ¼æ©Ÿèƒ½

---

## ğŸ” Phase 1: ã‚·ãƒ¼ãƒ³åˆ†å‰²ã®é€²æ—ç®¡ç†

### âœ… æ­£å¸¸ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
```sql
CREATE TABLE text_chunks (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  project_id INTEGER NOT NULL,
  idx INTEGER NOT NULL,
  text TEXT NOT NULL,
  status TEXT NOT NULL DEFAULT 'pending' 
    CHECK (status IN ('pending', 'processing', 'done', 'failed')),
  error_message TEXT,
  scene_count INTEGER DEFAULT 0,
  processed_at DATETIME,
  ...
)
```

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†:**
- `pending`: æœªå‡¦ç†
- `processing`: å‡¦ç†ä¸­
- `done`: æˆåŠŸ
- `failed`: å¤±æ•—ï¼ˆerror_messageã«ç†ç”±ã‚’è¨˜éŒ²ï¼‰

#### 2. é€²æ—ç¢ºèªAPI
```
GET /api/projects/:id/format/status
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "project_id": 26,
  "status": "formatting",
  "total_chunks": 16,
  "processed": 9,
  "failed": 0,
  "processing": 0,
  "pending": 7
}
```

âœ… **æ­£ç¢ºãªé€²æ—ãŒå–å¾—ã§ãã‚‹**

#### 3. ãƒãƒƒãƒå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
- **BATCH_SIZE = 3**: 1å›ã®APIå‘¼ã³å‡ºã—ã§æœ€å¤§3ãƒãƒ£ãƒ³ã‚¯ã‚’å‡¦ç†
- **è‡ªå‹•ãƒãƒ¼ã‚¸**: pending=0 && processing=0 ã®æ™‚ã€è‡ªå‹•çš„ã«å…¨ã‚·ãƒ¼ãƒ³ã‚’ãƒãƒ¼ã‚¸ã—ã¦formattedçŠ¶æ…‹ã«
- **ã‚¨ãƒ©ãƒ¼è¨˜éŒ²**: å„ãƒãƒ£ãƒ³ã‚¯ã®å¤±æ•—ç†ç”±ã‚’`error_message`ã«ä¿å­˜

#### 4. UIãƒãƒ¼ãƒªãƒ³ã‚°
- **5ç§’ã”ã¨ã«é€²æ—ç¢ºèª**
- **è‡ªå‹•å†é–‹æ©Ÿèƒ½**: ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã«`status='formatting'`ã‚’æ¤œå‡ºã—ã¦è‡ªå‹•å†é–‹
- **è‡ªå‹•ãƒãƒƒãƒå®Ÿè¡Œ**: `pending > 0 && processing === 0` ã®æ™‚ã€æ¬¡ã®ãƒãƒƒãƒã‚’è‡ªå‹•å®Ÿè¡Œ

### âœ… çµè«–: ã‚·ãƒ¼ãƒ³åˆ†å‰²ã¯å•é¡Œãªã—
- é€²æ—ç®¡ç†: âœ… æ­£ç¢º
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: âœ… chunkå˜ä½ã§è¨˜éŒ²
- ãƒªã‚«ãƒãƒªãƒ¼: âœ… è‡ªå‹•å†é–‹æ©Ÿèƒ½ã‚ã‚Š
- UIè¡¨ç¤º: âœ… ã€Œã‚·ãƒ¼ãƒ³åŒ–ä¸­â€¦ (3 / 16)ã€ã§æ­£ç¢ºã«è¡¨ç¤º

---

## ğŸ” Phase 2: ç”»åƒç”Ÿæˆã®é€²æ—ç®¡ç†

### âœ… æ­£å¸¸ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
```sql
CREATE TABLE image_generations (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  scene_id INTEGER NOT NULL,
  prompt TEXT NOT NULL,
  r2_key TEXT,
  r2_url TEXT,
  status TEXT NOT NULL DEFAULT 'pending' 
    CHECK (status IN ('pending', 'generating', 'completed', 'failed', 'policy_violation')),
  error_message TEXT,
  provider TEXT NOT NULL DEFAULT 'gemini',
  model TEXT NOT NULL DEFAULT 'gemini-3-pro-image-preview',
  is_active INTEGER NOT NULL DEFAULT 1 CHECK (is_active IN (0, 1)),
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  ...
)
```

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†:**
- `pending`: æœªç”Ÿæˆï¼ˆã¾ã ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„çŠ¶æ…‹ã‚‚å«ã‚€ï¼‰
- `generating`: ç”Ÿæˆä¸­
- `completed`: æˆåŠŸ
- `failed`: å¤±æ•—
- `policy_violation`: ãƒãƒªã‚·ãƒ¼é•å

#### 2. é€²æ—ç¢ºèªAPI
```
GET /api/projects/:id/generate-images/status
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "project_id": 26,
  "status": "generating_images",
  "total_scenes": 48,
  "processed": 10,
  "generating": 1,
  "pending": 37,
  "failed": 0
}
```

âœ… **æ­£ç¢ºãªé€²æ—ãŒå–å¾—ã§ãã‚‹**

#### 3. ãƒãƒƒãƒå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
- **BATCH_SIZE = 1**: Gemini APIãŒé…ã„ãŸã‚ã€1å›1ã‚·ãƒ¼ãƒ³ã®ã¿å‡¦ç†
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†**: 5åˆ†ä»¥ä¸Š`generating`çŠ¶æ…‹ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«`failed`ã«æ›´æ–°
- **ã‚¨ãƒ©ãƒ¼è¨˜éŒ²**: å¤±æ•—ç†ç”±ã‚’`error_message`ã«ä¿å­˜

#### 4. UIãƒãƒ¼ãƒªãƒ³ã‚°
- **5ç§’ã”ã¨ã«é€²æ—ç¢ºèª**
- **è‡ªå‹•ãƒãƒƒãƒå®Ÿè¡Œ**: `pending > 0 && generating === 0` ã®æ™‚ã€æ¬¡ã®ãƒãƒƒãƒã‚’è‡ªå‹•å®Ÿè¡Œ
- **æœ€å¤§25åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 300å›ãƒãƒ¼ãƒªãƒ³ã‚°å¾Œã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

### âœ… çµè«–: ç”»åƒç”Ÿæˆã®é€²æ—ç®¡ç†ã¯å•é¡Œãªã—
- é€²æ—ç®¡ç†: âœ… æ­£ç¢º
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: âœ… sceneå˜ä½ã§è¨˜éŒ²
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†: âœ… 5åˆ†ã§auto-fail
- UIè¡¨ç¤º: âœ… ã€Œç”»åƒç”Ÿæˆä¸­â€¦ (10/48)ã€ã§æ­£ç¢ºã«è¡¨ç¤º

---

## âš ï¸ Phase 3: ä¸€æ‹¬å‡¦ç†ä¸­ã®å€‹åˆ¥æ“ä½œã®ç«¶åˆå•é¡Œ

### ğŸš¨ **å•é¡Œç™ºè¦‹: ç«¶åˆåˆ¶å¾¡ãŒä¸ååˆ†**

#### ç¾åœ¨ã®å®Ÿè£…

**ä¸€æ‹¬ç”»åƒç”Ÿæˆ:**
```javascript
async function generateBulkImages(mode) {
  if (isProcessing) {
    showToast('å‡¦ç†ä¸­ã§ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„', 'warning');
    return;
  }
  isProcessing = true;  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒƒã‚¯
  // ...
}
```

**å˜ä½“ç”»åƒç”Ÿæˆ:**
```javascript
async function generateSceneImage(sceneId) {
  if (sceneProcessing[sceneId]) {
    showToast('ã“ã®ã‚·ãƒ¼ãƒ³ã¯å‡¦ç†ä¸­ã§ã™', 'warning');
    return;
  }
  sceneProcessing[sceneId] = true;  // ã‚·ãƒ¼ãƒ³å˜ä½ãƒ­ãƒƒã‚¯
  // ...
}
```

### ğŸ› **å•é¡Œç‚¹1: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒƒã‚¯ã¨ã‚·ãƒ¼ãƒ³ãƒ­ãƒƒã‚¯ã®ä¸æ•´åˆ**

**ã‚·ãƒŠãƒªã‚ª:**
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå…¨ç”»åƒç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `isProcessing = true` ã«ãªã‚‹ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒƒã‚¯ï¼‰
3. Scene #1 ãŒ `generating` çŠ¶æ…‹ã«ãªã‚‹
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Scene #5 ã®ã€Œç”»åƒç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
5. **å•é¡Œ**: `sceneProcessing[5]` ã¯ `false` ãªã®ã§ã€Scene #5 ã®ç”»åƒç”ŸæˆãŒ**é–‹å§‹ã•ã‚Œã¦ã—ã¾ã†**

**çµæœ:**
- Scene #5 ãŒ2å›ç”Ÿæˆã•ã‚Œã‚‹å¯èƒ½æ€§ï¼ˆä¸€æ‹¬å‡¦ç† + å€‹åˆ¥å‡¦ç†ï¼‰
- APIå´ã§ã¯`is_active=1`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ1ã¤ã®ã¿ãªã®ã§ã€æœ€å¾Œã®ç”ŸæˆçµæœãŒæ¡ç”¨ã•ã‚Œã‚‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ··ä¹±**: ã©ã¡ã‚‰ã®ç”ŸæˆãŒæœ‰åŠ¹ã‹ä¸æ˜ç¢º

### ğŸ› **å•é¡Œç‚¹2: UIä¸Šã®ãƒœã‚¿ãƒ³åˆ¶å¾¡ãŒä¸ååˆ†**

**ç¾åœ¨ã®å®Ÿè£…:**
- ä¸€æ‹¬ç”»åƒç”Ÿæˆä¸­ã§ã‚‚ã€`generating`çŠ¶æ…‹ã§ãªã„ã‚·ãƒ¼ãƒ³ã®ã€Œç”»åƒç”Ÿæˆã€ãƒœã‚¿ãƒ³ã¯**æŠ¼ã›ã‚‹**
- `isProcessing`ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ãƒ©ã‚°ã ãŒã€å€‹åˆ¥ãƒœã‚¿ãƒ³ã«ã¯åæ˜ ã•ã‚Œã¦ã„ãªã„

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
- ä¸€æ‹¬ç”»åƒç”Ÿæˆä¸­ã¯ã€**å…¨ã¦ã®å€‹åˆ¥ã€Œç”»åƒç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’disabled**ã«ã™ã¹ã
- ã¾ãŸã¯ã€ã€Œä¸€æ‹¬å‡¦ç†ä¸­ã§ã™ã€ã¨æ˜ç¤ºçš„ã«è¡¨ç¤º

### ğŸ› **å•é¡Œç‚¹3: APIãƒ¬ãƒ™ãƒ«ã§ã®ç«¶åˆåˆ¶å¾¡ãªã—

**ç¾åœ¨ã®APIå®Ÿè£…:**
```typescript
// POST /api/scenes/:id/generate-image (å˜ä½“ç”Ÿæˆ)
// - æ—¢å­˜ã® is_active=1 ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãªã—
// - å¸¸ã«æ–°ã—ã„ image_generations ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ

// POST /api/projects/:id/generate-images (ä¸€æ‹¬ç”Ÿæˆ)
// - æ—¢å­˜ã® is_active=1 ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚ã‚Š
// - LEFT JOIN ã§ is_active=1 ãŒãªã„sceneã®ã¿å‡¦ç†
```

**å•é¡Œ:**
- å˜ä½“ç”ŸæˆAPIã¯ã€æ—¢ã«ç”Ÿæˆä¸­ã®ã‚·ãƒ¼ãƒ³ã§ã‚‚æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã—ã¾ã†
- åŒã˜ã‚·ãƒ¼ãƒ³ã«å¯¾ã—ã¦è¤‡æ•°ã®`generating`ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒåŒæ™‚ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§

---

## ğŸ” Phase 4: å¤±æ•—æ™‚ã®ãƒªã‚«ãƒãƒªãƒ¼æ©Ÿèƒ½

### âœ… æ­£å¸¸ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†

#### 1. ã‚·ãƒ¼ãƒ³åˆ†å‰²ã®å¤±æ•—ã‚·ãƒ¼ãƒ³å†å®Ÿè¡Œ
```
POST /api/text_chunks/:id/retry
```

**æ©Ÿèƒ½:**
- å¤±æ•—ã—ãŸchunkã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’`pending`ã«ãƒªã‚»ãƒƒãƒˆ
- é–¢é€£ã™ã‚‹scenesã‚’å‰Šé™¤
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’`formatting`ã«æˆ»ã™

âœ… **chunkå˜ä½ã§å†å®Ÿè¡Œå¯èƒ½**

#### 2. ç”»åƒç”Ÿæˆã®å¤±æ•—ã‚·ãƒ¼ãƒ³å†ç”Ÿæˆ

**UIã«ã€Œå¤±æ•—ã‚·ãƒ¼ãƒ³ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚ã‚Š:**
```javascript
generateBulkImages('failed')
```

**APIãƒ­ã‚¸ãƒƒã‚¯:**
- `status='failed'` ã® image_generations ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŒã¤ã‚·ãƒ¼ãƒ³ã‚’å†åº¦ç”Ÿæˆ
- æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ is_active=1 ã«è¨­å®š

âœ… **å¤±æ•—ã‚·ãƒ¼ãƒ³ã®ã¿å†ç”Ÿæˆå¯èƒ½**

#### 3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†

**ã‚·ãƒ¼ãƒ³åˆ†å‰²:**
- chunkå˜ä½ã®è‡ªå‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã—ï¼ˆOpenAI APIãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ã¾ã§å¾…ã¤ï¼‰

**ç”»åƒç”Ÿæˆ:**
```typescript
// 5åˆ†ä»¥ä¸Š 'generating' çŠ¶æ…‹ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã« 'failed' ã«
await c.env.DB.prepare(`
  UPDATE image_generations
  SET status = 'failed', 
      error_message = 'Generation timeout (stuck for >5 minutes)'
  WHERE status = 'generating' 
    AND datetime(created_at, '+5 minutes') < datetime('now')
`).bind(projectId).run()
```

âœ… **5åˆ†ã§auto-failã€ãã®å¾Œå†ç”Ÿæˆå¯èƒ½**

### âœ… çµè«–: ãƒªã‚«ãƒãƒªãƒ¼æ©Ÿèƒ½ã¯ååˆ†
- ã‚·ãƒ¼ãƒ³åˆ†å‰²: âœ… chunkå˜ä½ã§å†å®Ÿè¡Œå¯èƒ½
- ç”»åƒç”Ÿæˆ: âœ… å¤±æ•—ã‚·ãƒ¼ãƒ³ã®ã¿å†ç”Ÿæˆå¯èƒ½
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: âœ… è‡ªå‹•çš„ã«failâ†’å†ç”Ÿæˆå¯èƒ½

---

## ğŸ“Š ç·åˆè©•ä¾¡

| æ©Ÿèƒ½ | é€²æ—ç®¡ç† | ã‚¨ãƒ©ãƒ¼è¨˜éŒ² | ãƒªã‚«ãƒãƒªãƒ¼ | ç«¶åˆåˆ¶å¾¡ | è©•ä¾¡ |
|------|---------|-----------|-----------|---------|------|
| ã‚·ãƒ¼ãƒ³åˆ†å‰² | âœ… æ­£ç¢º | âœ… chunkå˜ä½ | âœ… retry API | N/A | ğŸŸ¢ å•é¡Œãªã— |
| ç”»åƒç”Ÿæˆï¼ˆä¸€æ‹¬ï¼‰ | âœ… æ­£ç¢º | âœ… sceneå˜ä½ | âœ… å¤±æ•—ã‚·ãƒ¼ãƒ³å†ç”Ÿæˆ | âš ï¸ ä¸ååˆ† | ğŸŸ¡ æ”¹å–„å¿…è¦ |
| ç”»åƒç”Ÿæˆï¼ˆå€‹åˆ¥ï¼‰ | âœ… polling | âœ… errorè¡¨ç¤º | âœ… å†ç”Ÿæˆå¯èƒ½ | âš ï¸ ä¸ååˆ† | ğŸŸ¡ æ”¹å–„å¿…è¦ |

---

## ğŸš¨ å„ªå…ˆåº¦åˆ¥ã®æ”¹å–„ææ¡ˆ

### ğŸ”´ **å„ªå…ˆåº¦: é«˜**

#### 1. ä¸€æ‹¬å‡¦ç†ä¸­ã®å€‹åˆ¥ãƒœã‚¿ãƒ³ã‚’disabledåŒ–

**å•é¡Œ:**
- ä¸€æ‹¬ç”»åƒç”Ÿæˆä¸­ã«å€‹åˆ¥ã€Œç”»åƒç”Ÿæˆã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã¦ã—ã¾ã†
- ç«¶åˆãŒç™ºç”Ÿã—ã€ã©ã¡ã‚‰ã®ç”ŸæˆãŒæœ‰åŠ¹ã‹ä¸æ˜ç¢º

**è§£æ±ºç­–:**
```javascript
// renderBuilderScenes() å†…
const isGlobalProcessing = window.isProcessing || false;

// ãƒœã‚¿ãƒ³ç”Ÿæˆæ™‚
${!activeImage || imageStatus === 'failed'
  ? `<button 
       id="generateBtn-${scene.id}"
       onclick="generateSceneImage(${scene.id})"
       class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold touch-manipulation"
       ${isGlobalProcessing ? 'disabled' : ''}
     >
       <i class="fas fa-magic mr-2"></i>
       ${isGlobalProcessing ? 'ä¸€æ‹¬å‡¦ç†ä¸­...' : 'ç”»åƒç”Ÿæˆ'}
     </button>`
  : ...
}
```

#### 2. å˜ä½“ç”»åƒç”ŸæˆAPIã«ç«¶åˆãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 

**å•é¡Œ:**
- æ—¢ã«ç”Ÿæˆä¸­ã®ã‚·ãƒ¼ãƒ³ã«å¯¾ã—ã¦ã€æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã—ã¾ã†

**è§£æ±ºç­–:**
```typescript
// POST /api/scenes/:id/generate-image

// 1. æ—¢å­˜ã® generating ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
const existingGenerating = await c.env.DB.prepare(`
  SELECT id FROM image_generations
  WHERE scene_id = ? AND status = 'generating'
`).bind(sceneId).first()

if (existingGenerating) {
  return c.json({
    error: {
      code: 'ALREADY_GENERATING',
      message: 'Image is already being generated for this scene'
    }
  }, 409)
}
```

### ğŸŸ¡ **å„ªå…ˆåº¦: ä¸­**

#### 3. ä¸€æ‹¬å‡¦ç†ä¸­ã®é€²æ—ã‚’ã‚ˆã‚Šè©³ç´°ã«è¡¨ç¤º

**ç¾åœ¨:**
- ã€Œç”»åƒç”Ÿæˆä¸­â€¦ (10/48)ã€ã®ã¿

**æ”¹å–„æ¡ˆ:**
```
ç”»åƒç”Ÿæˆä¸­â€¦ (10/48)
âœ… å®Œäº†: 8ä»¶ | ğŸ”„ ç”Ÿæˆä¸­: 2ä»¶ | âŒ å¤±æ•—: 0ä»¶ | â³ å¾…æ©Ÿä¸­: 38ä»¶
```

#### 4. å¤±æ•—ã‚·ãƒ¼ãƒ³ã®è©³ç´°è¡¨ç¤º

**ç¾åœ¨:**
- å¤±æ•—ã—ãŸã‚·ãƒ¼ãƒ³ã¯èµ¤ã„ãƒãƒƒã‚¸ã§è¡¨ç¤ºã•ã‚Œã‚‹ã®ã¿

**æ”¹å–„æ¡ˆ:**
- å¤±æ•—ç†ç”±ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§è¡¨ç¤º
- ä¸€æ‹¬ã§å¤±æ•—ã‚·ãƒ¼ãƒ³ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«

### ğŸŸ¢ **å„ªå…ˆåº¦: ä½**

#### 5. ã‚·ãƒ¼ãƒ³åˆ†å‰²ã®chunkå˜ä½é€²æ—è¡¨ç¤º

**ç¾åœ¨:**
- ã€Œã‚·ãƒ¼ãƒ³åŒ–ä¸­â€¦ (3 / 16)ã€
- chunkå˜ä½ã®è©³ç´°ã¯è¡¨ç¤ºã•ã‚Œãªã„

**æ”¹å–„æ¡ˆ:**
```
ã‚·ãƒ¼ãƒ³åŒ–ä¸­â€¦ (3 / 16 chunks)
- Chunk 1: âœ… 3ã‚·ãƒ¼ãƒ³ç”Ÿæˆ
- Chunk 2: âœ… 2ã‚·ãƒ¼ãƒ³ç”Ÿæˆ
- Chunk 3: âœ… 4ã‚·ãƒ¼ãƒ³ç”Ÿæˆ
- Chunk 4: ğŸ”„ å‡¦ç†ä¸­...
```

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å³åº§ã«å®Ÿè£…ã™ã¹ãä¿®æ­£

1. **ä¸€æ‹¬å‡¦ç†ä¸­ã®å€‹åˆ¥ãƒœã‚¿ãƒ³ã‚’disabledåŒ–** (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)
2. **å˜ä½“ç”»åƒç”ŸæˆAPIã«ç«¶åˆãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ** (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰)

### ä»Šå¾Œã®æ”¹å–„

3. é€²æ—è¡¨ç¤ºã®è©³ç´°åŒ–
4. å¤±æ•—ã‚·ãƒ¼ãƒ³ã®è©³ç´°è¡¨ç¤º
5. chunkå˜ä½é€²æ—è¡¨ç¤º

---

æœ€çµ‚æ›´æ–°: 2025-01-19
